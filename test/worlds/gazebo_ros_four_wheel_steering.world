<!--
// Copyright 2019 Open Source Robotics Foundation, Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
-->
<?xml version="1.0" ?>
<!--
  Four wheel steering drive plugin demo

  Try sending commands:

    ros2 topic pub /test/cmd_4ws four_wheel_steering_msgs/msg/FourWheelSteering '{speed: 1.0, front_steering_angle: 0.0, rear_steering_angle: 0.0}' -1

-->
<sdf version="1.6">
  <world name="default">
    <include>
      <uri>model://ground_plane</uri>
    </include>

    <include>
      <uri>model://sun</uri>
    </include>

    <physics type="ode">
      <max_step_size>0.001</max_step_size>
      <ode>
        <solver>
          <friction_model>cone_model</friction_model>
        </solver>
      </ode>
    </physics>

    <model name="vehicle">
      <pose>0 0 0.5 0 0 0</pose>
      <link name="chassis">
        <pose>0 0 0.5 0 0 0.0</pose>
        <inertial>
          <mass>750.0</mass>
          <pose>-0.05 0 -0.1 0 0</pose>
          <inertia>
            <ixx>163.125</ixx>
            <iyy>413.125</iyy>
            <izz>531.25</izz>
            <ixy>0.0</ixy>
            <ixz>0.0</ixz>
            <iyz>0.0</iyz>
          </inertia>
        </inertial>
        <visual name="chassis_visual">
          <geometry>
            <box>
              <size>2.0 1.2 0.6</size>
            </box>
          </geometry>
        </visual>
        <collision name="chassis">
          <geometry>
            <box>
              <size>2.0 1.2 0.6</size>
            </box>
          </geometry>
        </collision>
      </link>

      <link name="front_right_wheel_link">
        <pose>0.8 -0.75 0.05 -1.5705 0 0</pose>
        <inertial>
          <mass>11</mass>
          <inertia>
            <ixx>0.41300485416666666</ixx>
            <iyy>0.41300485416666666</iyy>
            <izz>0.6718263749999999</izz>
            <ixy>0.0</ixy>
            <ixz>0.0</ixz>
            <iyz>0.0</iyz>
          </inertia>
        </inertial>
        <visual name="visual">
          <geometry>
            <cylinder>
              <length>0.29</length>
              <radius>0.3495</radius>
            </cylinder>
          </geometry>
        </visual>
        <collision name="collision">
          <geometry>
            <cylinder>
              <length>0.29</length>
              <radius>0.3495</radius>
            </cylinder>
          </geometry>
          <surface>
            <friction>
              <ode>
                <mu>1.1</mu>
                <mu2>1.1</mu2>
              </ode>
            </friction>
            <contact>
              <ode>
                <min_depth>0.001</min_depth>
                <kp>1e9</kp>
              </ode>
            </contact>
          </surface>
        </collision>
      </link>

      <link name="front_left_wheel_link">
        <pose>0.8 0.75 0.05 -1.5705 0 0</pose>
        <inertial>
          <mass>11</mass>
          <inertia>
            <ixx>0.41300485416666666</ixx>
            <iyy>0.41300485416666666</iyy>
            <izz>0.6718263749999999</izz>
            <ixy>0.0</ixy>
            <ixz>0.0</ixz>
            <iyz>0.0</iyz>
          </inertia>
        </inertial>
        <visual name="visual">
          <geometry>
            <cylinder>
              <length>0.29</length>
              <radius>0.3495</radius>
            </cylinder>
          </geometry>
        </visual>
        <collision name="collision">
          <geometry>
            <cylinder>
              <length>0.29</length>
              <radius>0.3495</radius>
            </cylinder>
          </geometry>
          <surface>
            <friction>
              <ode>
                <mu>1.1</mu>
                <mu2>1.1</mu2>
              </ode>
            </friction>
            <contact>
              <ode>
                <min_depth>0.001</min_depth>
                <kp>1e9</kp>
              </ode>
            </contact>
          </surface>
        </collision>
      </link>

      <link name="rear_right_wheel_link">
        <pose>-0.8 -0.75 0.05 -1.5705 0 0</pose>
        <inertial>
          <mass>11</mass>
          <inertia>
            <ixx>0.41300485416666666</ixx>
            <iyy>0.41300485416666666</iyy>
            <izz>0.6718263749999999</izz>
            <ixy>0.0</ixy>
            <ixz>0.0</ixz>
            <iyz>0.0</iyz>
          </inertia>
        </inertial>
        <visual name="visual">
          <geometry>
            <cylinder>
              <length>0.29</length>
              <radius>0.3495</radius>
            </cylinder>
          </geometry>
        </visual>
        <collision name="collision">
          <geometry>
            <cylinder>
              <length>0.29</length>
              <radius>0.3495</radius>
            </cylinder>
          </geometry>
          <surface>
            <friction>
              <ode>
                <mu>1.1</mu>
                <mu2>1.1</mu2>
              </ode>
            </friction>
            <contact>
              <ode>
                <min_depth>0.001</min_depth>
                <kp>1e9</kp>
              </ode>
            </contact>
          </surface>
        </collision>
      </link>

      <link name="rear_left_wheel_link">
        <pose>-0.8 0.75 0.05 -1.5705 0 0</pose>
        <inertial>
          <mass>11</mass>
          <inertia>
            <ixx>0.41300485416666666</ixx>
            <iyy>0.41300485416666666</iyy>
            <izz>0.6718263749999999</izz>
            <ixy>0.0</ixy>
            <ixz>0.0</ixz>
            <iyz>0.0</iyz>
          </inertia>
        </inertial>
        <visual name="visual">
          <geometry>
            <cylinder>
              <length>0.29</length>
              <radius>0.3495</radius>
            </cylinder>
          </geometry>
        </visual>
        <collision name="collision">
          <geometry>
            <cylinder>
              <length>0.29</length>
              <radius>0.3495</radius>
            </cylinder>
          </geometry>
          <surface>
            <friction>
              <ode>
                <mu>1.1</mu>
                <mu2>1.1</mu2>
              </ode>
            </friction>
            <contact>
              <ode>
                <min_depth>0.001</min_depth>
                <kp>1e9</kp>
              </ode>
            </contact>
          </surface>
        </collision>
      </link>

      <link name="front_right_axle">
        <pose>0.8 -0.65 0.05 0 0 0</pose>
        <inertial>
          <mass>2</mass>
          <inertia>
            <ixx>0.001666667</ixx>
            <ixy>0.0</ixy>
            <iyy>0.001666667</iyy>
            <ixz>0.0</ixz>
            <iyz>0.0</iyz>
            <izz>0.0025</izz>
          </inertia>
        </inertial>
        <visual name="visual">
          <geometry>
            <cylinder>
              <length>0.05</length>
              <radius>0.05</radius>
            </cylinder>
          </geometry>
        </visual>
        <collision name="collision">
          <geometry>
            <cylinder>
              <length>0.05</length>
              <radius>0.05</radius>
            </cylinder>
          </geometry>
        </collision>
      </link>

      <link name="front_left_axle">
        <pose>0.8 0.65 0.05 0 0 0</pose>
        <inertial>
          <mass>2</mass>
          <inertia>
            <ixx>0.001666667</ixx>
            <ixy>0.0</ixy>
            <iyy>0.001666667</iyy>
            <ixz>0.0</ixz>
            <iyz>0.0</iyz>
            <izz>0.0025</izz>
          </inertia>
        </inertial>
        <visual name="visual">
          <geometry>
            <cylinder>
              <length>0.05</length>
              <radius>0.05</radius>
            </cylinder>
          </geometry>
        </visual>
        <collision name="collision">
          <geometry>
            <cylinder>
              <length>0.05</length>
              <radius>0.05</radius>
            </cylinder>
          </geometry>
        </collision>
      </link>

      <link name="rear_left_axle">
        <pose>-0.8 0.65 0.05 0 0 0</pose>
        <inertial>
          <mass>2</mass>
          <inertia>
            <ixx>0.001666667</ixx>
            <ixy>0.0</ixy>
            <iyy>0.001666667</iyy>
            <ixz>0.0</ixz>
            <iyz>0.0</iyz>
            <izz>0.0025</izz>
          </inertia>
        </inertial>
        <visual name="visual">
          <geometry>
            <cylinder>
              <length>0.05</length>
              <radius>0.05</radius>
            </cylinder>
          </geometry>
        </visual>
        <collision name="collision">
          <geometry>
            <cylinder>
              <length>0.05</length>
              <radius>0.05</radius>
            </cylinder>
          </geometry>
        </collision>
      </link>

      <link name="rear_right_axle">
        <pose>-0.8 -0.65 0.05 0 0 0</pose>
        <inertial>
          <mass>2</mass>
          <inertia>
            <ixx>0.001666667</ixx>
            <ixy>0.0</ixy>
            <iyy>0.001666667</iyy>
            <ixz>0.0</ixz>
            <iyz>0.0</iyz>
            <izz>0.0025</izz>
          </inertia>
        </inertial>
        <visual name="visual">
          <geometry>
            <cylinder>
              <length>0.05</length>
              <radius>0.05</radius>
            </cylinder>
          </geometry>
        </visual>
        <collision name="collision">
          <geometry>
            <cylinder>
              <length>0.05</length>
              <radius>0.05</radius>
            </cylinder>
          </geometry>
        </collision>
      </link>

      <joint name="front_right_steering" type="revolute">
        <parent>chassis</parent>
        <child>front_right_axle</child>
        <axis>
          <xyz>0 0 1</xyz>
          <limit>
            <lower>-0.62</lower>
            <upper>0.62</upper>
            <effort>1000</effort>
            <velocity>1.24</velocity>
          </limit>
          <dynamics>
            <damping>1</damping>
            <friction>0</friction>
          </dynamics>
        </axis>
        <physics>
          <ode>
            <cfm_damping>1</cfm_damping>
          </ode>
        </physics>
      </joint>

      <joint name="front_right_wheel" type="revolute">
        <parent>front_right_axle</parent>
        <child>front_right_wheel_link</child>
        <axis>
          <xyz>0 0 1</xyz>
          <dynamics>
            <friction>12</friction>
          </dynamics>
          <limit>
            <effort>755</effort>
            <velocity>6.358</velocity>
          </limit>
        </axis>
      </joint>

      <joint name="front_left_steering" type="revolute">
        <parent>chassis</parent>
        <child>front_left_axle</child>
        <axis>
          <xyz>0 0 1</xyz>
          <limit>
            <lower>-0.62</lower>
            <upper>0.62</upper>
            <effort>1000</effort>
            <velocity>1.24</velocity>
          </limit>
          <dynamics>
            <damping>1</damping>
            <friction>0</friction>
          </dynamics>
        </axis>
        <physics>
          <ode>
            <cfm_damping>1</cfm_damping>
          </ode>
        </physics>
      </joint>

      <joint name="front_left_wheel" type="revolute">
        <parent>front_left_axle</parent>
        <child>front_left_wheel_link</child>
        <axis>
          <xyz>0 0 1</xyz>
          <dynamics>
            <friction>12</friction>
          </dynamics>
          <limit>
            <effort>755</effort>
            <velocity>6.358</velocity>
          </limit>
        </axis>
      </joint>

      <joint name="rear_right_steering" type="revolute">
        <parent>chassis</parent>
        <child>rear_right_axle</child>
        <axis>
          <xyz>0 0 1</xyz>
          <limit>
            <lower>-0.62</lower>
            <upper>0.62</upper>
            <effort>1000</effort>
            <velocity>1.24</velocity>
          </limit>
          <dynamics>
            <damping>1</damping>
            <friction>0</friction>
          </dynamics>
        </axis>
        <physics>
          <ode>
            <cfm_damping>1</cfm_damping>
          </ode>
        </physics>
      </joint>

      <joint name="rear_right_wheel" type="revolute">
        <parent>rear_right_axle</parent>
        <child>rear_right_wheel_link</child>
        <axis>
          <xyz>0 0 1</xyz>
          <dynamics>
            <friction>12</friction>
          </dynamics>
          <limit>
            <effort>755</effort>
            <velocity>6.358</velocity>
          </limit>
        </axis>
      </joint>

      <joint name="rear_left_steering" type="revolute">
        <parent>chassis</parent>
        <child>rear_left_axle</child>
        <axis>
          <xyz>0 0 1</xyz>
          <limit>
            <lower>-0.62</lower>
            <upper>0.62</upper>
            <effort>1000</effort>
            <velocity>1.4</velocity>
          </limit>
          <dynamics>
            <damping>1</damping>
            <friction>0</friction>
          </dynamics>
        </axis>
        <physics>
          <ode>
            <cfm_damping>1</cfm_damping>
          </ode>
        </physics>
      </joint>

      <joint name="rear_left_wheel" type="revolute">
        <parent>rear_left_axle</parent>
        <child>rear_left_wheel_link</child>
        <axis>
          <xyz>0 0 1</xyz>
          <dynamics>
            <friction>12</friction>
          </dynamics>
          <limit>
            <effort>755</effort>
            <velocity>6.358</velocity>
          </limit>
        </axis>
      </joint>

      <plugin name="gazebo_ros_4ws" filename="libgazebo_ros_four_wheel_steering.so">
        <ros>
          <namespace>test</namespace>
        </ros>
        <front_right_wheel_pid_gain>400 0 1</front_right_wheel_pid_gain>
        <front_left_wheel_pid_gain>400 0 1</front_left_wheel_pid_gain>
        <rear_right_wheel_pid_gain>400 0 1</rear_right_wheel_pid_gain>
        <rear_left_wheel_pid_gain>400 0 1</rear_left_wheel_pid_gain>

        <front_right_steering_pid_gain>2000 0 2</front_right_steering_pid_gain>
        <front_left_steering_pid_gain>2000 0 2</front_left_steering_pid_gain>
        <rear_right_steering_pid_gain>2000 0 2</rear_right_steering_pid_gain>
        <rear_left_steering_pid_gain>2000 0 2</rear_left_steering_pid_gain>
      </plugin>
    </model>
  </world>
</sdf>